<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØµØ§Ù†Ø¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ===== Ø£Ø³Ø§Ø³ÙŠØ§Øª (Mobileâ€‘first) ===== */
    :root{
      --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --bg:#f8fafc; --card:#ffffff;
      --brand:#3b82f6; --ok:#10b981; --danger:#ef4444; --chip:#eef2ff; --chipText:#1e3a8a;
      --shadow:0 10px 24px rgba(0,0,0,.06);
      --radius:14px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Cairo',system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--ink);}

    /* Ø®Ù„ÙÙŠØ© ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡ Ù‡Ø§Ø¯Ø¦Ø© */
    body[data-theme="morning"]{background:linear-gradient(180deg,#e0f2ff,#f8fbff)}
    body[data-theme="evening"]{background:linear-gradient(180deg,#0b1020,#1c1530);color:#eef2ff}
    body[data-theme="evening"] .card{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)}
    body[data-theme="evening"] .muted{color:#c7d2fe}

    .page{max-width:680px; margin-inline:auto; padding:16px 14px 24px}
    h1{margin:10px 0 4px; font-size:clamp(22px, 4vw, 28px)}
    .muted{color:var(--muted)}

    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow)}

    /* ØµÙ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Mobileâ€‘first: Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯) */
    .row{display:grid; grid-template-columns:1fr; gap:10px}
    @media (min-width:560px){ .row{grid-template-columns:1fr 1fr auto} }

    label{font-size:14px; color:var(--muted); margin-bottom:6px; display:block}
    input[type="text"]{width:100%; padding:14px; border:1px solid var(--line); border-radius:12px; font:inherit}

    /* Ø£Ø²Ø±Ø§Ø±: ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø®Ø· = Ù†ÙØ³ Ø®Ø· Ø§Ù„ØµÙØ­Ø© */
    .btn{appearance:none; border:0; border-radius:12px; padding:14px 16px; cursor:pointer; font-family:inherit; font-weight:700; line-height:1; 
         transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease; min-height:48px;}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:#fff; border:1px solid var(--line)}
    .btn-primary{background:var(--brand); color:#fff; box-shadow:0 8px 18px rgba(59,130,246,.22)}
    /* Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø£Ø®Ø¶Ø± */
    .btn-success{background:var(--ok); color:#fff; box-shadow:0 8px 18px rgba(16,185,129,.22)}
    .btn-danger{background:var(--danger); color:#fff}
    body[data-theme="evening"] .btn-ghost{background:transparent; color:#eef2ff; border-color:rgba(255,255,255,.12)}

    .list{margin-top:12px; display:grid; gap:8px}
    .item{display:flex; gap:10px; align-items:center; justify-content:space-between; border:1px dashed var(--line); border-radius:12px; padding:12px; background:#fff}
    body[data-theme="evening"] .item{background:rgba(255,255,255,.04)}
    .item b{font-weight:700}
    .item small{color:var(--muted)}

    .footer-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-top:14px}
    .hint{font-size:13px}

    .chip{display:inline-flex; align-items:center; gap:8px; background:var(--chip); color:var(--chipText); padding:8px 12px; border-radius:999px; font-size:13px}
    body[data-theme="evening"] .chip{background:#312e81; color:#c7d2fe}

    .hero{margin:8px 0 14px}
  </style>
</head>
<body>
  <div class="page">
    <h1>ØµØ§Ù†Ø¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h1>
    <div class="hero muted" id="greet"></div>

    <div class="card">
      <div class="row">
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</label>
          <input id="tName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù…Ù„ Ø§Ù„Ø´Ø±ÙŠÙ" />
        </div>
        <div>
          <label>Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</label>
          <input id="tReason" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª" />
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end;justify-content:flex-end">
          <button class="btn btn-primary" id="addRow">+ Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>

      <div class="list" id="list"></div>

      <div class="footer-actions">
        <span class="chip" id="count">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØºÙŠØ¨Ø§Øª</span>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-ghost" id="clear">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
          <button class="btn btn-success" id="export">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>
      <div class="hint muted" style="margin-top:6px">Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ØªÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ PDF. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡.</div>
    </div>
  </div>

  <script>
    // ØªØ­ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© + Ø³Ù…Ø© ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡
    (function(){
      const h = new Date().getHours();
      const morning = h >= 5 && h < 17;
      document.body.setAttribute('data-theme', morning ? 'morning' : 'evening');
      document.getElementById('greet').textContent = morning ? 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± Ø§Ø¨ØªØ³Ø§Ù… â˜€ï¸' : 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± Ø§Ø¨ØªØ³Ø§Ù… ğŸŒ™';
    })();

    const $ = (s)=>document.querySelector(s);
    const list = $('#list');
    const tName = $('#tName');
    const tReason = $('#tReason');
    const countChip = $('#count');

    function renderCount(){
      const n = list.children.length;
      countChip.textContent = n ? `Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØºÙŠØ¨Ø§Øª: ${n}` : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØºÙŠØ¨Ø§Øª';
    }

    function addRow(name, reason){
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `
        <div style="flex:1;min-width:0">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <b class="name"></b>
            <small class="reason muted"></small>
          </div>
        </div>
        <button class="btn btn-danger btn-sm">Ø­Ø°Ù</button>`;
      el.querySelector('.name').textContent = name;
      el.querySelector('.reason').textContent = `â€” ${reason}`;
      el.querySelector('button').onclick = ()=>{ el.remove(); renderCount(); };
      list.appendChild(el);
      renderCount();
    }

    function tryAdd(){
      const name = tName.value.trim();
      const reason = tReason.value.trim();
      if(!name || !reason){
        // ØªØ¨Ø³ÙŠØ·: Ù…Ù† Ø¯ÙˆÙ† ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø²Ø¹Ø¬ â€” Ù†ÙˆØ¬Ù‡ Ø§Ù„ØªØ±ÙƒÙŠØ²
        if(!name) tName.focus(); else tReason.focus();
        return;
      }
      addRow(name, reason);
      tName.value = '';
      tReason.value = '';
      tName.focus();
    }

    $('#addRow').onclick = tryAdd;
    tReason.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryAdd(); });
    tName.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tReason.focus(); });

    $('#clear').onclick = ()=>{
      if(!list.children.length) return;
      if(confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØºÙŠØ¨Ø§ØªØŸ')){ list.innerHTML=''; renderCount(); }
    };

    $('#export').onclick = async ()=>{
      const rows = Array.from(list.children).map((el)=>({
        name: el.querySelector('.name').textContent.trim(),
        reason: el.querySelector('.reason').textContent.replace(/^â€”\s*/, '').trim(),
      }));

      const fd = new FormData();
      fd.append('rows_json', JSON.stringify(rows));

      const btn = $('#export');
      const label = btn.textContent;
      btn.disabled = true; btn.textContent = 'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±â€¦';

      // Ø¯Ø¹Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ù…Ù† :3000 Ø£Ùˆ :8000
      const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') && (location.port === '3000')
        ? 'http://127.0.0.1:8000' : '';

      try{
        const res = await fetch(`${API_BASE}/api/pdf`, { method:'POST', body: fd });
        if(!res.ok){ throw new Error(await res.text()); }
        const blob = await res.blob();
        const a = document.createElement('a');
        const url = URL.createObjectURL(blob);
        a.href = url; a.download = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø¬ÙˆÙ„Ø§Øª_${Date.now()}.pdf`;
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      }catch(e){
        alert('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF');
      }finally{
        btn.disabled = false; btn.textContent = label;
      }
    };
  </script>
</body>
</html>
